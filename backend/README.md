## API Reference

### Getting Started

## Error Handling

Errors are returned as JSON objects in the following format, with an example below for code error ``400``:


````python
    @app.errorhandler(400)
    def bad_request(error):
        return jsonify({
            "return_code":0,
            'error': <error description>,
        }), 400
````

The API will return the following error types when requests fail:
````python
400: Bad Request
401: Unauthorized
404: Resource Not Found
405: Method Not Allowed
500: Internal Server Error
````

## Endpoint (AUTHENTICATION)

###### NOTE:
All endpoints at this point require a **valid JWT** token generated by Authorisation.

#### POST ``/signup``
- General:
    - Used to signup a new user on the web app.
- Sample:
````json

{
    "first_name": "Peter",
    "last_name": "Parker",
    "email": "peter.parker@gmail.com",
    "date_of_birth": "2002-02-19",
    "password": "peter"
}
````
- Returns:
If user already exists in the database:
````json

{
    "return_code":0,
    "error": "User Already Exists"
}, 409 CONFLICT
````
If user does not exist in the database:
````json

{
    "return_code": 1,
    "access_token": "<JWT_TOKEN>",
    "id": 3,
    "name": "<FULL NAME OF USER>",
} 200 OK
````
If required parameters are missing:
````json

{
    "return_code":0,
    "error": "User Already Exists"
}, 409 CONFLICT
````

#### POST ``/login``
- General:
    - Used to log in the user with the given credentials.
- Sample:
````json

{
{
    "email": "peter.parker@gmail.com",
    "password": "peter"
}
}
````
- Returns:
If user credentials are correct:
````json

{
    "name": "Peter Parker",
    "id": 3,
    "return_code": 2,
    "session_token": "<JWT_TOKEN>"
}, 200 OK
````

If user credentials are NOT correct(EMAIL Incorrect):
````json

{
    "return_code":0,
    "error": "User Not found with the given Email"
}, 404 NOT FOUND
````

If user credentials are NOT correct(PASSWORD Incorrect):
````json

{
    "return_code":1,
    "error": "Incorrect password, please try again"
}, 401 Unauthorized
````



#### GET ``/logout``
- General:
    - Logouts authenticated user and unsets the JWT token.
- Authentication:
    - requires JWT token to be set.
- Returns:
If user is logged in.
````json
{
    "msg": "logout successful"
}, 200 OK
````


## Endpoint (MEMBERSHIP APIs)

### Constants Library

The following constants are used throughout the Membership APIs:

- **PaymentMethod Enum:** Specifies the accepted payment methods, including PayPal, Google Pay, Apple Pay, AliPay, and Credit Card.
- **MembershipType Enum:** Defines the available membership tiers: Basic, Standard, and Premium.
- **MembershipDuration Enum:** Lists the valid durations for membership subscriptions, such as Monthly and Annually.
- **MembershipPrice Enum:** Provides the prices for each membership type and duration combination.

````python
class PaymentMethod(Enum):
    PAYPAL = "PayPal"
    GOOGLE_PAY = "Google Pay"
    APPLE_PAY = "Apple Pay"
    ALIPAY = "AliPay"
    CREDIT_CARD = "Credit Card"

class MembershipType(Enum):
    BASIC = "Basic"
    STANDARD = "Standard"
    PREMIUM = "Premium"

class MembershipDuration(Enum):
    MONTHLY = "Monthly"
    ANNUALLY = "Annually"

class MembershipPrice(Enum):
    BASIC_MONTHLY_PRICE = 8.00
    BASIC_ANNUAL_PRICE = 80.00
    STANDARD_MONTHLY_PRICE = 15.00
    STANDARD_ANNUAL_PRICE = 120.00
    PREMIUM_MONTHLY_PRICE = 22.00
    PREMIUM_ANNUAL_PRICE = 180.00
````

> [!IMPORTANT]
> All endpoints at this point requires a valid JWT token generated by Authentication for the processing.

#### POST ``/buy_membership``
- **General:**
   - Allows a user to purchase a membership.

- **Authentication:**

  - This endpoint require a valid JWT for the route.

- **Request Body:**

  - ``membership_type``: Type of membership to purchase -> Defined in [constants.py](constants.py).
  - ``duration``: Duration of the membership -> Defined in [constants.py](constants.py).
  - ``mode_of_payment``: Mode of payment for the membership -> Defined in [constants.py](constants.py).


> [!NOTE]
All the parameters required for the request body can be found in the consants library:
> *    [Membership Type](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L30-L33)
> *    [Membership Duration](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L35-L37)
> *    [Membership Price](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L40-L46)



**Sample Success Body:**

> [!TIP]
> Take a look at -> [Buy membership success test](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/tests/test_project.py#L200C1-L204C57) for a detailed json post request. 

```json
{
    "membership_type": "Membership Type",
    "duration":  "Membership Duration",
    "mode_of_payment": "Membership Price"
}
```

**Returns:**

If the membership is purchased successfully:

```json
{
    "return_code": 1,
    "message": "Membership purchased successfully"
}, 200 OK
```

If required parameters are missing:
```json
{
    "return_code": 0,
    "error": "Missing Required Fields"
}, 400 BAD REQUEST
```

If there's an invalid duration:
```json
{
    "return_code": 0,
    "error": "Invalid duration" 
}, 400 BAD REQUEST
```
If there's an invalid mode of payment:
```json
{
    "return_code": 0,
    "error": "Invalid mode of payment"
}, 400 BAD REQUEST
```
If there's an invalid membership type:
```json
{
    "return_code": 0,
    "error": "Invalid membership type"
}, 400 BAD REQUEST
```

If the access token is missing or invalid:
```json
{
    "return_code": 0,
    "message": "Missing or invalid access token."
}, 401 Unauthorized
```

#### DELETE ``/cancel_membership``
- **General:**
  - Cancels the auto-renewal of a user's membership.

- **Authentication:**
  - This endpoint require a valid JWT for the route.


**Returns:**

If the membership is cancelled before the end date:
```json
{
    "return_code": 1,
    "message": "Auto-renew disabled successfully."
}, 200 OK
```

If membership is cancelled on the end date:
```json
{
    "return_code": 1,
    "message": "Membership cancelled and auto-renew disabled successfully."
}, 200 OK
```

If user does not have an active membership:
```json
{
    "return_code": 0,
    "error": "User does not have an active membership."
}, 404 NOT FOUND
```


If the access token is missing or invalid:
```json
{
    "return_code": 0,
    "message": "Missing or invalid access token."
}, 401 Unauthorized
```
## Endpoint (FRIENDSHIP APIs)

#### POST ``/send_friend_request``
- **General:**
   - Allows a user to send a friend request to another user.

- **Authentication:**

  - This endpoint require a valid JWT for the route.

- **Request Body:**
- ``email``: The email address of the user to whom the friend request is being sent.

- **Sample Success Body:**
```json
{
    "email": "bob@example.com"
}
```

- **Returns:**
- If the friend request is sent successfully:
```json
{
    "message": "Friend request sent successfully"
}, 200 OK
```

- If the friend request is sent successfully:
```json
{
    "error": "User is already a friend"
}, 400 BAD REQUEST
```
- If a friend request to the user is already pending:
```json
{
    "error": "Friend request already pending"
}, 400 BAD REQUEST
```

- If the specified user to send the request to does not exist:

```json
{
    "error": "Addressee not found"
}, 404 NOT FOUND
```
- If attempting to send a request to oneself:
```json
{
    "error": "Cannot send friend request to yourself"
}, 400 BAD REQUEST
```

- If the access token is missing or invalid:
```json
{
    "error": "Missing or invalid access token."
}, 401 UNAUTHORIZED
```


#### POST ``/accept_friend_request``
- **General:**
   - Allows a user to accept a friend request from another user.

- **Authentication:**

  - This endpoint require a valid JWT for the route.

- **Request Body:**
- ``email``: The email address of the user to whom the friend request is being sent.

- **Returns:**
- If the friend request is accepted successfully:
```json
{
    "message": "Friend request accepted"
}, 200 OK
```
- If the friend request to be accepted was not found:
```json
{
    "error": "Friend request not found"
}, 404 NOT FOUND
```
- If the access token is missing or invalid:
```json
{
    "error": "Missing or invalid access token."
}, 401 UNAUTHORIZED
```
#### POST ``/reject_friend_request``

- **General:**
   - Allows a user to reject a friend request from another user.

- **Authentication:**

  - This endpoint require a valid JWT for the route.

- **Request Body:**
- ``email``: The email address of the user to whom the friend request is being sent.

- **Returns:**
- If the friend request is rejected successfully:
```json
{
    "message": "Friend request rejected"
}, 200 OK
```
- If the friend request to be rejected was not found:
```json
{
    "error": "Friend request not found"
}, 404 NOT FOUND
```

- If the access token is missing or invalid:
```json
{
    "error": "Missing or invalid access token."
}, 401 UNAUTHORIZED
```

#### POST ``/list_friend_requests``

- **General:**
   - Lists all pending friend requests for the current user.

- **Authentication:**

  - This endpoint require a valid JWT for the route.


- **Returns:**
- A JSON response containing a list of pending friend requests, each entry including the email and name of the user who sent the request.
```json
{
    "pending_requests": [
        {
            "email": "sender@example.com",
            "name": "Sender Name"
        },
        {
            "email": "another_sender@example.com",
            "name": "Another Sender Name"
        }
    ]
}
```

- If the access token is missing or invalid:
```json
{
    "error": "Missing or invalid access token."
}, 401 UNAUTHORIZED
```


#### POST ``/list_friends``

- **General:**
   - Lists all friends of the current user.

- **Authentication:**

  - This endpoint require a valid JWT for the route.


- **Returns:**
- A JSON response containing a list of friends, each entry including the email and name of the friend.

```json
{
    "friends": [
        {
            "email": "friend1@example.com",
            "name": "Friend One"
        },
        {
            "email": "friend2@example.com",
            "name": "Friend Two"
        }
    ]
}
```
- If the access token is missing or invalid:

```json
{
    "error": "Missing or invalid access token."
}, 401 UNAUTHORIZED
```

## Endpoint (GPS APIs)
### GPS APIs

#### GET `/get_journeys_of_user`
- **General:**
  - Retrieves all journeys associated with the authenticated user.
- **Authentication:**
  - Requires a valid JWT token.
- **Returns:**
  - If journeys exist for the user:
    ```json
    {
        "status": 200,
        "data": [
            {
                "id": 1,
                "name": "Morning Run",
                "type": "Running",
                "totalDistance": 5.0,
                "elevation": {
                    "avg": 120,
                    "min": 100,
                    "max": 140
                },
                "points": [
                    {"lat": 38.5, "lon": -120.2, "ele": 100},
                    {"lat": 38.6, "lon": -120.3, "ele": 110}
                ],
                "startTime": "07:30:00",
                "endTime": "08:15:00",
                "dateCreated": "2024-03-12"
            }
        ]
    }
    ```
  - If no journeys are found for the user:
    ```json
    {
        "status": 404,
        "message": "No journeys found for given userId"
    }
    ```

#### POST `/create_journey`
- **General:**
  - Creates a new journey for the authenticated user.
- **Authentication:**
  - Requires a valid JWT token.
- **Request Body:**
  - The JSON object should contain `name`, `type`, `totalDistance`, `elevation` (with `avg`, `min`, `max`), `points` (with `lat`, `lon`, `ele` for each point), `startTime`, `endTime`, and `dateCreated`.
- **Returns:**
  - If the journey is created successfully:
    ```json
    {
        "status": 201,
        "message": "Journey created successfully"
    }
    ```
  - If there's an error (e.g., missing required fields, invalid date/time format):
    ```json
    {
        "status": 400,
        "error": "Error message detailing what went wrong"
    }
    ```

#### DELETE `/delete_journey/<int:journeyId>`
- **General:**
  - Deletes a specific journey associated with the authenticated user.
- **Authentication:**
  - Requires a valid JWT token.
- **Returns:**
  - If the journey is deleted successfully:
    ```json
    {
        "status": 200,
        "message": "Journey deleted successfully"
    }
    ```
  - If the specified journey does not exist:
    ```json
    {
        "status": 404,
        "message": "Journey not found"
    }
    ```

#### PUT `/update_journey/<int:journeyId>`
- **General:**
  - Updates a specific journey associated with the authenticated user.
- **Authentication:**
  - Requires a valid JWT token.
- **Request Body:**
  - The JSON object should contain any of the fields that need updating, similar to those specified for the creation endpoint.
- **Returns:**
  - If the journey is updated successfully:
    ```json
    {
        "status": 200,
        "message": "Journey updated successfully"
    }
    ```
  - If there's an error (e.g., journey not found, invalid date/time format):
    ```json
    {
        "status": 400,
        "error": "Error message detailing what went wrong"
    }
    ```

### Example Request Body for `POST /create_journey`

```json
{
  "name": "Evening Walk",
  "type": "Walking",
  "totalDistance": 3.5,
  "elevation": {
    "avg": 120.0,
    "min": 100.0,
    "max": 150.0
  },
  "points": [
    {
      "lat": 38.897957,
      "lon": -77.036560,
      "ele": 100.0
    },
    {
      "lat": 38.898956,
      "lon": -77.037560,
      "ele": 110.0
    },
    {
      "lat": 38.899955,
      "lon": -77.038560,
      "ele": 120.0
    }
  ],
  "startTime": "18:00:00",
  "endTime": "19:30:00",
  "dateCreated": "2024-03-15"
}
```