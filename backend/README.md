## API Reference

### Getting Started

## Error Handling

Errors are returned as JSON objects in the following format, with an example below for code error `400`:

```python
    @app.errorhandler(400)
    def bad_request(error):
        return jsonify({
            "return_code":0,
            'error': <error description>,
        }), 400
```

The API will return the following error types when requests fail:

```python
400: Bad Request
401: Unauthorized
404: Resource Not Found
405: Method Not Allowed
500: Internal Server Error
```

## Endpoint (AUTHENTICATION)

###### NOTE:

All endpoints at this point require a **valid JWT** token generated by Authorisation.

#### POST `/signup`

- General:
  - Used to signup a new user on the web app.
- Sample:

```json
{
  "first_name": "Peter",
  "last_name": "Parker",
  "email": "peter.parker@gmail.com",
  "date_of_birth": "2002-02-19",
  "password": "peter"
}
```

- Returns:
  If user already exists in the database:

```json

{
    "return_code":0,
    "error": "User Already Exists"
}, 409 CONFLICT
```

If user does not exist in the database:

```json

{
    "return_code": 1,
    "access_token": "<JWT_TOKEN>",
    "id": 3,
    "name": "<FULL NAME OF USER>",
} 200 OK
```

If required parameters are missing:

```json

{
    "return_code":0,
    "error": "User Already Exists"
}, 409 CONFLICT
```

#### POST `/login`

- General:
  - Used to log in the user with the given credentials.
- Sample:

```json

{
{
    "email": "peter.parker@gmail.com",
    "password": "peter"
}
}
```

- Returns:
  If user credentials are correct:

```json

{
    "name": "Peter Parker",
    "id": 3,
    "return_code": 2,
    "session_token": "<JWT_TOKEN>"
}, 200 OK
```

If user credentials are NOT correct(EMAIL Incorrect):

```json

{
    "return_code":0,
    "error": "User Not found with the given Email"
}, 404 NOT FOUND
```

If user credentials are NOT correct(PASSWORD Incorrect):

```json

{
    "return_code":1,
    "error": "Incorrect password, please try again"
}, 401 Unauthorized
```

#### GET `/logout`

- General:
  - Logouts authenticated user and unsets the JWT token.
- Authentication:
  - requires JWT token to be set.
- Returns:
  If user is logged in.

```json
{
    "msg": "logout successful"
}, 200 OK
```

## Endpoint (MEMBERSHIP APIs)

### Constants Library

The following constants are used throughout the Membership APIs:

- **PaymentMethod Enum:** Specifies the accepted payment methods, including PayPal, Google Pay, Apple Pay, AliPay, and Credit Card.
- **MembershipType Enum:** Defines the available membership tiers: Basic, Standard, and Premium.
- **MembershipDuration Enum:** Lists the valid durations for membership subscriptions, such as Monthly and Annually.
- **MembershipPriceMonthly Enum:** Provides the prices for each membership type of monthly duration.
- **MembershipPriceAnnually Enum:** Provides the prices for each membership type of annual duration.

```python
class PaymentMethod(Enum):
    PAYPAL = "PayPal"
    GOOGLE_PAY = "Google Pay"
    APPLE_PAY = "Apple Pay"
    ALIPAY = "AliPay"
    CREDIT_CARD = "Credit Card"

class MembershipType(Enum):
    BASIC = "Basic"
    STANDARD = "Standard"
    PREMIUM = "Premium"

class MembershipDuration(Enum):
    MONTHLY = "Monthly"
    ANNUALLY = "Annually"

class MembershipPriceMonthly(Enum):
    BASIC_MONTHLY_PRICE = 8.00
    STANDARD_MONTHLY_PRICE = 15.00
    PREMIUM_MONTHLY_PRICE = 22.00

class MembershipPriceAnnually(Enum):
    BASIC_ANNUAL_PRICE = 80.00
    STANDARD_ANNUAL_PRICE = 120.00
    PREMIUM_ANNUAL_PRICE = 180.00


```

> [!IMPORTANT]
> All endpoints at this point requires a valid JWT token generated by Authentication for the processing.

#### POST `/buy_membership`

- **General:**

  - Allows a user to purchase a membership.

- **Authentication:**

  - This endpoint require a valid JWT for the route.

- **Request Body:**

  - `membership_type`: Type of membership to purchase -> Defined in [constants.py](constants.py).
  - `duration`: Duration of the membership -> Defined in [constants.py](constants.py).
  - `mode_of_payment`: Mode of payment for the membership -> Defined in [constants.py](constants.py).

> [!NOTE]
> All the parameters required for the request body can be found in the consants library:
>
> - [Membership Type](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L30-L33)
> - [Membership Duration](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L35-L37)
> - [Membership Price](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/constants.py#L40-L46)

**Sample Success Body:**

> [!TIP]
> Take a look at -> [Buy membership success test](https://github.com/uol-feps-soc-comp2913-2324s2-classroom/team-project-team-26/blob/03fe2471c2a5ddbb5f53afa8b8d10f37561f1dca/backend/tests/test_project.py#L200C1-L204C57) for a detailed json post request.

```json
{
  "membership_type": "Membership Type",
  "duration": "Membership Duration",
  "mode_of_payment": "Membership Price"
}
```

**Returns:**

If the membership is purchased successfully:

```json
{
    "return_code": 1,
    "message": "Membership purchased successfully"
}, 200 OK
```

If required parameters are missing:

```json
{
    "return_code": 0,
    "error": "Missing Required Fields"
}, 400 BAD REQUEST
```

If there's an invalid duration:

```json
{
    "return_code": 0,
    "error": "Invalid duration"
}, 400 BAD REQUEST
```

If there's an invalid mode of payment:

```json
{
    "return_code": 0,
    "error": "Invalid mode of payment"
}, 400 BAD REQUEST
```

If there's an invalid membership type:

```json
{
    "return_code": 0,
    "error": "Invalid membership type"
}, 400 BAD REQUEST
```

If the access token is missing or invalid:

```json
{
    "return_code": 0,
    "message": "Missing or invalid access token."
}, 401 Unauthorized
```

#### DELETE `/cancel_membership`

- **General:**

  - Cancels the auto-renewal of a user's membership.

- **Authentication:**
  - This endpoint require a valid JWT for the route.

**Returns:**

If the membership is cancelled before the end date:

```json
{
    "return_code": 1,
    "message": "Auto-renew disabled successfully."
}, 200 OK
```

If membership is cancelled on the end date:

```json
{
    "return_code": 1,
    "message": "Membership cancelled and auto-renew disabled successfully."
}, 200 OK
```

If user does not have an active membership:

```json
{
    "return_code": 0,
    "error": "User does not have an active membership."
}, 404 NOT FOUND
```

If the access token is missing or invalid:

```json
{
    "return_code": 0,
    "message": "Missing or invalid access token."
}, 401 Unauthorized
```
